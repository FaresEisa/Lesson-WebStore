<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lessons</title>
  <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
</head>

<body>
  <div id="app">
    <header>
      <h1 v-text="sitename"></h1>

      <!-- Disable checkout button if cart is empty -->
      <button 
        v-on:click="showCheckout"
        :disabled="cart.length === 0">
        Cart ({{ itemsInCart }}) - Checkout
      </button>
      <button> sort </button>
    </header>

    <!-- Product List -->
    <main v-if="showProduct">
      <h2>Available Lessons</h2>

      <figure v-for="product in products" :key="product.id">
        <p>Subject: {{ product.subject }}</p>
        <p>Location: {{ product.location }}</p>
        <p>Price: ${{ product.price }}</p>
        <p>Space left: {{ product.availableItems }}</p>

        <!-- Add to cart -->
        <button 
          v-if="product.availableItems > 0" 
          v-on:click="addItemToTheCart(product)">
          Add to cart
        </button>

        <!-- Remove from cart -->
        <button 
          v-if="product.availableItems < product.maxItems" 
          v-on:click="removeItemFromCart(product)">
          Remove from cart
        </button>

        <div v-if="product.availableItems === 0">
          <button disabled>Add to Cart</button>
          No more available items.
        </div>
      </figure>
    </main>

    <!-- Checkout Page -->
    <main v-else>
      <h2>Checkout</h2> 

      <div v-if="cart.length > 0">
        <div v-for="product in checkoutItems" :key="product.id" class="checkout-item">
          <p>Subject: {{ product.subject }}</p>
          <p>Location: {{ product.location }}</p>
          <p>Price: ${{ product.price }}</p>

          <button v-on:click="removeItemFromCart(product)"> Remove</button>
        </div>
      </div>

      <div v-else>
        <p>Your cart is empty.</p>
      </div>

      <button v-on:click="showProduct = true">Back to Lessons</button>
    </main>
  </div>

  <script>
    new Vue({
      el: "#app",
      data: {
        sitename: "Lessons",
        showProduct: true,
        products: [
          { id: "1001", subject: "Math", price: 100, location: "Newport", availableItems: 5, maxItems: 5 },
          { id: "1002", subject: "English", price: 90, location: "London", availableItems: 9, maxItems: 9 },
        ],
        cart: [],
      },
      methods: {
        showCheckout() {
          if (this.cart.length > 0) {
            this.showProduct = false;
          }
        },
        addItemToTheCart(product) {
          if (product.availableItems > 0) {
            this.cart.push(product.id);
            product.availableItems--;
          }
        },
        removeItemFromCart(product) {
          // find and remove one instance of the product
          for (let i = 0; i < this.cart.length; i++) {
            if (this.cart[i] === product.id) {
              this.cart.splice(i, 1);
              product.availableItems++;
              break;
            }
          }
        },
      },
      computed: {
        itemsInCart() {
          return this.cart.length;
        },
        checkoutItems() {
          // return only the items in the cart
          return this.products.filter(product => this.cart.includes(product.id));
        },
      },
    });
  </script>
</body>

</html>


